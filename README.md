BogusDependencies provides common code for analyzing C# compiler and C++ linker outputs to determine which inputs are not actually necessary to building the final output. These bogus dependencies can then be surfaced in tooling to feed back to developers to help reduce package and project-to-project references. This reduces the complexity and depth of the build dependency graph along with reducing file I/O and processing during the build, resulting in lower overall build time.

This repo was created for Microsoft Hackathon 2020.

## C++ Bogus Dependencies
The Microsoft C++ Linker includes a flag [/VERBOSE:UNUSEDLIBS](https://docs.microsoft.com/en-us/cpp/build/reference/verbose-print-progress-messages?redirectedfrom=MSDN&view=vs-2019) that writes additional information to stdout about .lib files that were unused. A similar flag `/VERBOSE:UNUSEDDELAYLOAD` can point to delay-load DLL references whose code was unused.

## C# Bogus Dependencies
An experimental branch of the Roslyn compiler repo includes a feature, Used Assembly References, that allows bogus dependency detection. See the [issue](https://github.com/dotnet/roslyn/issues/37768) and the [branch](https://github.com/dotnet/roslyn/tree/features/UsedAssemblyReferences). New feature documentation in the branch is [here](https://github.com/dotnet/roslyn/blob/features/UsedAssemblyReferences/docs/features/UsedAssemblyReferences.md).

The feature exposes a new Roslyn analyzer API, `GetUsedAssemblyReferences`, to allow retrieving the assemblies that were actually used in generating the compilation output. Subtracting that list from the list of compiler input assemblies results in bogus assembly inputs.

## Making Use of Bogus Dependency Information
For each bogus input, mapping to the source of the input can find one of:

* A bogus project-to-project dependency if the input is generated by another project in the build. This feedback can result in either a developer making use of the input or cutting the dependency. Applied recursively, this could mean removing dead projects and code from a repo. The fastest build time is for code that is not compiled.
* An unneeded package reference, e.g. to a [Vcpkg](https://github.com/microsoft/vcpkg) C++ package or NuGet .NET package. This reduces compile/link I/O and CPU but does not change the build dependency graph. If this is the last such package reference, the package could be removed as a dependency of the repo, reducing build prep time by eliminating package pull requests.
* An unneeded C++ SDK library reference that could be cut, reducing link I/O and CPU.

## Related Work
https://github.com/dfederm/ReferenceTrimmer wraps an MSBuild execution and compares the assemblies pulled forward by RAR (MSBuild ResolveAssemblyReferences) to those referenced from proj-to-proj and package references, and recommends removals. The work in this repo can be combined with that work to make its recommendations much more robust, as without the Roslyn feature noted above, the compiler and RAR will leave behind referenced assemblies where only const values or interfaces were used, resulting in broken builds where packages or ProjectReferences were removed unnecessarily.

# Contributing
See [Contributing.md](./Contributing.md).
